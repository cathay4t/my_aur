_pkgbase=scsi_debug
pkgname=scsi_debug-dkms
pkgver=4.5
pkgrel=1
pkgdesc="SCSI debug adapter driver"
arch=('i686' 'x86_64')
url="http://sg.danny.cz/sg/sdebug26.html"
license=('GPL')
depends=('dkms')
provides=('scsi_debug-dkms' 'scsi_debug-module')
conflicts=("scsi_debug-module")
install=${pkgname}.install
options=(!strip)

source=("scsi_debug-${pkgver}.tar.xz" "dkms.conf" "scsi_debug-dkms.install")

sha256sums=('86feae249b70ca485b6bd957e72778d99bdb6fbdbd5e6b864e6538824336f6c7'
            '2340f2c62175fe0a9c766ada51882db65e5d1885cee2cd835b816a460c72a938'
            'e818ed8de07e2197c1eace413eabdc50a43fd8d37c168c761a5fef1c0bd9f84d')

package() {

    installDir="$pkgdir/usr/src/${_pkgbase}-${pkgver}"

    install -dm755 "$installDir"
    install -m644 "$srcdir/dkms.conf" "$installDir"

    sed -e "s/@_PKGBASE@/${_pkgbase}/" \
        -e "s/@PKGVER@/${pkgver}/" \
        -i $installDir/dkms.conf

    cd "${srcdir}/"

    install -dm755  "$installDir/${_pkgbase}-${pkgver}"

    for f in ${srcdir}/${_pkgbase}-${pkgver}/*; do
        install -m644 "$f" "$installDir/$(basename $f)"
    done
}
